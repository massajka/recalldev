+# Обзор потока бота

+Ниже краткое описание пути пользователя. Диаграмма последовательности будет добавлена позднее.

+| # | Триггер | Действие бота | Состояние пользователя |
+|---|---------|--------------|------------------------|
+| 1 | `/start` или `/language` | Предлагает выбрать язык, если ещё не выбран | `IDLE` → `IDLE` |
+| 2 | Выбор языка | Подтверждает выбор, **авто-запускает диагностику** | `IDLE` → `DIAGNOSTICS` |
+| 3 | Диагностический вопрос | Отправляет вопрос, ждёт оценку | `DIAGNOSTICS` |
+| 4 | Кнопка оценки (1-5) | Сохраняет балл, отправляет следующий вопрос | `DIAGNOSTICS` |
+| 5 | После последнего вопроса диагностики | Сохраняет все оценки, генерирует план практики через LLM, уведомляет (`/practice`) | `DIAGNOSTICS` → `PRACTICE` |
+| 6 | `/practice` | Проверяет язык и диагностику, отправляет текущий вопрос практики | `PRACTICE` и устанавливает `WAITING_FOR_ANSWER` |
+| 7 | Текстовый ответ | Отправляет в LLM, сохраняет фидбэк, отправляет его + кнопку **Следующий вопрос** | `WAITING_FOR_ANSWER` |
+| 8 | Кнопка «Следующий вопрос» | Отправляет следующий вопрос или сообщение о завершении | `PRACTICE` |
+
+### Примечания
+* Диагностика обязательна для каждого языка; повторный запуск возможен командой `/diagnostics`.
+* Генерация плана практики полностью автоматическая и идемпотентна.
+* Тяжёлые вызовы LLM обёрнуты в проверки; при недоступности выводятся запасные сообщения.
+* Контроллеры (`callbacks.py`) не содержат бизнес-логики — только оркестрация flows и views.
+
+---
+## Поток ↔️ Машина состояний
+
+```mermaid
+stateDiagram-v2
+    [*] --> IDLE
+    IDLE --> DIAGNOSTICS: язык_выбран
+    DIAGNOSTICS --> PRACTICE: диагностика_завершена
+    PRACTICE --> WAITING_FOR_ANSWER: вопрос_отправлен
+    WAITING_FOR_ANSWER --> PRACTICE: ответ_сохранён
+    PRACTICE --> IDLE: практика_завершена
+```
